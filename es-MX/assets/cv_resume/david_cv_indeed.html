<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CV - David Muñoz Cruz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        -webkit-print-color-adjust: exact;
      }
      @media print {
        body,
        .main-container {
          margin: 0;
          padding: 0;
          box-shadow: none;
        }
        .no-print {
          display: none;
        }
      }
      .main-container {
        max-width: 100%;
        min-height: 11in;
        margin: auto;
        background: white;
      }
      .section-title {
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 8px;
        margin-bottom: 16px;
        font-size: 1.25rem;
        font-weight: 700;
        color: #111827;
        text-transform: uppercase;
      }
      .job-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1e40af;
      }
      .company-info {
        font-size: 0.95rem;
        color: #4b5563;
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border-left-color: #09f;
        animation: spin 1s ease infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 p-4 md:p-8">
    <div
      id="main-content"
      class="main-container p-8 md:p-12 shadow-lg bg-white"
    >
      <!-- AI Actions -->
      <div class="text-right mb-8 no-print">
        <button
          id="generate-cover-letter-btn"
          class="bg-sky-600 text-white px-4 py-2 rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold flex items-center justify-center ml-auto"
        >
          <span id="cover-letter-btn-text">Generar Carta de Presentación</span>
          <div id="cover-letter-spinner" class="spinner hidden ml-2"></div>
        </button>
      </div>

      <!-- Header -->
      <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800">David Muñoz Cruz</h1>
        <h2 class="text-lg font-medium text-sky-700">Full-Stack Developer</h2>
        <div
          class="mt-4 text-sm text-gray-600 flex justify-center items-center flex-wrap gap-x-6 gap-y-2"
        >
          <span>+52 246 209 3346</span>
          <span>•</span>
          <a
            href="mailto:davidmctf@gmail.com"
            class="text-sky-600 hover:underline"
            >davidmctf@gmail.com</a
          >
          <span>•</span>
          <a
            href="https://www.linkedin.com/in/davidmct"
            target="_blank"
            class="text-sky-600 hover:underline"
            >LinkedIn</a
          >
          <span>•</span>
          <a
            href="https://github.com/davidmctf"
            target="_blank"
            class="text-sky-600 hover:underline"
            >GitHub</a
          >
          <span>•</span>
          <a
            href="https://davidmctf.github.io/"
            target="_blank"
            class="text-sky-600 hover:underline"
            >Portafolio</a
          >
        </div>
      </header>

      <!-- Profile Section -->
      <section class="mb-6">
        <div class="flex justify-between items-center mb-2">
          <h3 class="section-title w-full">Perfil Profesional</h3>
          <button
            id="optimize-profile-btn"
            class="no-print bg-blue-100 text-blue-800 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors text-xs font-semibold flex items-center whitespace-nowrap ml-4"
          >
            <span id="optimize-btn-text">✨ Optimizar con IA</span>
            <div
              id="optimize-spinner"
              class="spinner hidden ml-2"
              style="width: 16px; height: 16px"
            ></div>
          </button>
        </div>
        <p id="profile-text" class="text-gray-700 text-sm leading-relaxed">
          Desarrollador Full-Stack cualificado con experiencia en tecnologías
          frontend y backend modernas. Especializado en arquitecturas de
          microservicios, integración de herramientas de IA y soluciones de
          e-commerce. Gran capacidad de resolución de problemas y propuesta de
          nuevas tecnologías para mejorar la eficiencia del desarrollo. Fuerte
          orientación al trabajo en equipo complementada con excelentes
          habilidades de autogestión. Con experiencia en implementación de
          herramientas de IA, automatización de procesos y optimización de
          experiencia del usuario. Aprendizaje continuo, ampliación constante de
          conocimientos a través de proyectos innovadores y tecnologías
          emergentes.
        </p>
      </section>

      <!-- Experience Section -->
      <section id="experience-section" class="mb-6">
        <h3 class="section-title">Experiencia Laboral</h3>
        <div class="space-y-6">
          <article>
            <h4 class="job-title">Full-Stack Developer</h4>
            <p class="company-info">The Rocket Code | Marzo 2025 - Actual</p>
            <ul
              class="list-disc list-inside mt-2 text-sm text-gray-700 space-y-1"
            >
              <li>
                Implementación de herramientas con Claude AI, Gemini y
                LangGraph.
              </li>
              <li>
                Desarrollo de APIs con NestJS y arquitecturas de microservicios.
              </li>
              <li>
                Creación de interfaces con NextJS, React y Angular v18/v19.
              </li>
              <li>
                Especialización en desarrollo y administración de Shopify.
              </li>
              <li>
                Desarrollo de aplicaciones para el sector asegurador y fintech.
              </li>
            </ul>
          </article>
          <article>
            <h4 class="job-title">Backend Developer</h4>
            <p class="company-info">BLIFE | Septiembre 2024 - Marzo 2025</p>
            <ul
              class="list-disc list-inside mt-2 text-sm text-gray-700 space-y-1"
            >
              <li>
                Desarrollo y gestión de microservicios en NestJS con NATS y
                GraphQL.
              </li>
              <li>Desarrollo de Blife-e-Signature con Flask y Python.</li>
              <li>
                Implementación de CI/CD con GitHub Actions y despliegue en AWS.
              </li>
            </ul>
          </article>
          <article>
            <h4 class="job-title">Full-Stack Developer</h4>
            <p class="company-info">
              MIDOCONLINE | Abril 2024 - Septiembre 2024
            </p>
            <ul
              class="list-disc list-inside mt-2 text-sm text-gray-700 space-y-1"
            >
              <li>
                Lideré la refactorización completa del backend, migrándolo de
                Laravel 8 a Laravel 11, optimizando su arquitectura y mejorando
                el rendimiento significativamente.
              </li>
            </ul>
          </article>
          <article>
            <h4 class="job-title">Full-Stack Developer</h4>
            <p class="company-info">SKYTEX | Enero 2022 - Abril 2024</p>
            <ul
              class="list-disc list-inside mt-2 text-sm text-gray-700 space-y-1"
            >
              <li>
                Desarrollo de ERP interno (Skynet 2.0) y portal de facturación
                (SkyInvoiceHub).
              </li>
              <li>
                Migración de app de logística a Kotlin con Jetpack Compose y
                MVVM.
              </li>
              <li>
                Implementación de control de accesos con WebSockets y
                Dockerización de apps.
              </li>
            </ul>
          </article>
        </div>
      </section>

      <!-- Skills Section -->
      <section id="skills-section" class="mb-6">
        <h3 class="section-title">Habilidades Técnicas</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">Backend</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>NestJS, Node.js</li>
              <li>Laravel, PHP</li>
              <li>Python, Flask, Rust</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">Frontend</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>Angular, NextJS, React</li>
              <li>TypeScript, JavaScript</li>
              <li>HTML5, CSS3, SCSS</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">Bases de Datos</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>PostgreSQL (pgvector)</li>
              <li>MongoDB Atlas, MySQL</li>
              <li>Redis</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">Cloud & DevOps</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>AWS Services, CI/CD</li>
              <li>Docker, Git</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">AI & E-commerce</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>Claude AI, Gemini</li>
              <li>LangGraph, Shopify</li>
            </ul>
          </div>
          <div>
            <h5 class="font-semibold text-gray-800 mb-1">Mobile</h5>
            <ul class="list-disc list-inside text-gray-700">
              <li>Kotlin, Jetpack Compose</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Education Section -->
      <section id="education-section">
        <h3 class="section-title">Educación</h3>
        <div>
          <h4 class="job-title">Ingeniería en Tecnologías de la Información</h4>
          <p class="company-info">
            Universidad Politécnica de Tlaxcala | 2018 - 2022
          </p>
        </div>
      </section>
    </div>

    <!-- Modal for Cover Letter -->
    <div
      id="cover-letter-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden no-print"
    >
      <div
        class="bg-white rounded-lg shadow-xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-xl font-bold text-gray-800">
            Carta de Presentación Generada
          </h4>
          <button
            id="close-modal-btn"
            class="text-gray-500 hover:text-gray-800"
          >
            &times;
          </button>
        </div>
        <div
          id="modal-content"
          class="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed"
        ></div>
      </div>
    </div>

    <script>
      // --- DOM Elements ---
      const optimizeProfileBtn = document.getElementById(
        "optimize-profile-btn",
      );
      const generateCoverLetterBtn = document.getElementById(
        "generate-cover-letter-btn",
      );
      const closeModalBtn = document.getElementById("close-modal-btn");
      const coverLetterModal = document.getElementById("cover-letter-modal");
      const modalContent = document.getElementById("modal-content");

      // --- Gemini API Configuration ---
      const API_KEY = ""; // API key will be injected by the environment
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

      // --- Helper function to manage loading state ---
      const setLoadingState = (
        button,
        spinner,
        textElement,
        text,
        isLoading,
      ) => {
        const buttonText = document.getElementById(textElement);
        if (isLoading) {
          button.disabled = true;
          buttonText.classList.add("hidden");
          document.getElementById(spinner).classList.remove("hidden");
        } else {
          button.disabled = false;
          buttonText.classList.remove("hidden");
          buttonText.innerText = text;
          document.getElementById(spinner).classList.add("hidden");
        }
      };

      // --- Function to call Gemini API with exponential backoff ---
      async function callGemini(prompt, maxRetries = 3) {
        let attempt = 0;
        let delay = 1000; // start with 1 second

        while (attempt < maxRetries) {
          try {
            const payload = {
              contents: [
                {
                  role: "user",
                  parts: [{ text: prompt }],
                },
              ],
            };
            const response = await fetch(API_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            if (
              result.candidates &&
              result.candidates.length > 0 &&
              result.candidates[0].content.parts.length > 0
            ) {
              return result.candidates[0].content.parts[0].text;
            } else {
              throw new Error("Respuesta inválida de la API de Gemini.");
            }
          } catch (error) {
            attempt++;
            if (attempt >= maxRetries) {
              console.error(
                "Error fetching data from Gemini API after multiple retries:",
                error,
              );
              return "Hubo un error al contactar la IA. Por favor, inténtalo de nuevo más tarde.";
            }
            await new Promise((res) => setTimeout(res, delay));
            delay *= 2; // Double the delay for the next retry
          }
        }
      }

      // --- Event Listener for Profile Optimization ---
      optimizeProfileBtn.addEventListener("click", async () => {
        setLoadingState(
          optimizeProfileBtn,
          "optimize-spinner",
          "optimize-btn-text",
          "✨ Optimizar con IA",
          true,
        );
        const profileTextElement = document.getElementById("profile-text");
        const originalProfile = profileTextElement.innerText;

        const prompt = `Reescribe el siguiente perfil profesional para un currículum de un desarrollador Full-Stack. Hazlo más conciso, profesional y orientado a resultados. Usa un tono seguro y destaca el impacto. No uses más de 100 palabras. Perfil original: "${originalProfile}"`;

        const optimizedProfile = await callGemini(prompt);
        profileTextElement.innerText = optimizedProfile;

        setLoadingState(
          optimizeProfileBtn,
          "optimize-spinner",
          "optimize-btn-text",
          "✨ Optimizar con IA",
          false,
        );
      });

      // --- Event Listener for Cover Letter Generation ---
      generateCoverLetterBtn.addEventListener("click", async () => {
        setLoadingState(
          generateCoverLetterBtn,
          "cover-letter-spinner",
          "cover-letter-btn-text",
          "Generar Carta de Presentación",
          true,
        );

        // Scrape CV content
        const profile = document.getElementById("profile-text").innerText;
        const experience =
          document.getElementById("experience-section").innerText;
        const skills = document.getElementById("skills-section").innerText;
        const education =
          document.getElementById("education-section").innerText;
        const cvContent = `Perfil: ${profile}\n\nExperiencia: ${experience}\n\nHabilidades: ${skills}\n\nEducación: ${education}`;

        const prompt = `Basado en el siguiente currículum, escribe una carta de presentación profesional, persuasiva y concisa en español. La carta debe estar dirigida a un gerente de contratación para un puesto de Desarrollador Full-Stack. Debe destacar las habilidades y experiencias más relevantes, mostrando entusiasmo por el puesto. Formatea la carta con párrafos claros y un cierre profesional.\n\nCurrículum:\n---\n${cvContent}`;

        const coverLetter = await callGemini(prompt);
        modalContent.innerText = coverLetter;
        coverLetterModal.classList.remove("hidden");

        setLoadingState(
          generateCoverLetterBtn,
          "cover-letter-spinner",
          "cover-letter-btn-text",
          "Generar Carta de Presentación",
          false,
        );
      });

      // --- Event Listener for Closing Modal ---
      closeModalBtn.addEventListener("click", () => {
        coverLetterModal.classList.add("hidden");
      });

      // Close modal on outside click
      coverLetterModal.addEventListener("click", (e) => {
        if (e.target === coverLetterModal) {
          coverLetterModal.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
